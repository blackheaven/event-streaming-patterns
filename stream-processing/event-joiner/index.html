<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Event Joiner - Event Streaming Patterns</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Event Joiner";
    var mkdocs_page_input_path = "stream-processing/event-joiner.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Event Streaming Patterns</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Event Streaming Patterns</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Compositional patterns</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../compositional-patterns/command-query-responsibility-segregation/">Command Query Responsibility Segregation (CQRS)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../compositional-patterns/event-collaboration/">Event Collaboration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../compositional-patterns/geo-replication/">Geo Replication</a>
                </li>
                <li class="">
                    
    <a class="" href="../../compositional-patterns/pipeline/">Pipeline</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event/correlation-identifier/">Correlation Identifier</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event-deserializer/">Event Deserializer</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event-envelope/">Event Envelope</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event-serializer/">Event Serializer</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event-standardizer/">Event Standardizer</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event/">Event</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/schema-on-read/">Schema-On-Read</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event processing</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event-processing/claim-check/">Claim Check</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/dead-letter-stream/">Dead Letter Stream</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/event-chunking/">Event Chunking</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/event-filter/">Event Filter</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/event-mapper/">Event Mapper</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/event-processing-application/">Event Processing Application</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/event-processor/">Event Processor</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/event-router/">Event Router</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/event-splitter/">Event Splitter</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/event-streaming-api/">Event Streaming API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-processing/event-translator/">Event Translator</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event sink</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event-sink/event-sink-connector/">Event Sink Connector</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-sink/event-sink/">Event Sink</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event source</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event-source/database-write-aside/">Database Write Aside</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/database-write-through/">Database Write Through</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/event-gateway/">Event Gateway</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/event-source-connector/">Event Source Connector</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/event-source/">Event Source</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/schema-validator/">Schema Validator</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event storage</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event-storage/compacted-event-stream/">Compacted Event Stream</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-storage/event-store/">Event Store</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-storage/infinite-retention-event-stream/">Infinite Retention Event Stream</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event stream</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event-stream/event-broker/">Event Broker</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-stream/event-stream/">Event Stream</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Stream processing</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../event-grouper/">Event Grouper</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Event Joiner</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#event-joiner">Event Joiner</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#problem">Problem</a></li>
        
            <li><a class="toctree-l4" href="#solution">Solution</a></li>
        
            <li><a class="toctree-l4" href="#implementation">Implementation</a></li>
        
            <li><a class="toctree-l4" href="#considerations">Considerations</a></li>
        
            <li><a class="toctree-l4" href="#references">References</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../event-stream-merger/">Event Stream Merger</a>
                </li>
                <li class="">
                    
    <a class="" href="../event-time-processing/">Event-Time Processing</a>
                </li>
                <li class="">
                    
    <a class="" href="../logical-and/">Logical AND</a>
                </li>
                <li class="">
                    
    <a class="" href="../suppressed-event-aggregator/">Suppressed Event Aggregator</a>
                </li>
                <li class="">
                    
    <a class="" href="../wait-for-n-events/">Wait for N Events</a>
                </li>
                <li class="">
                    
    <a class="" href="../wallclock-time/">Wallclock-Time Processing</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Table</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../table/projection-table/">Projection Table</a>
                </li>
                <li class="">
                    
    <a class="" href="../../table/state-table/">State Table</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Event Streaming Patterns</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Stream processing &raquo;</li>
        
      
    
    <li>Event Joiner</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="event-joiner">Event Joiner</h1>
<p><a href="../../event-stream/event-stream/">Event Streams</a> may need to be joined (i.e., enriched) with a <a href="../../table/state-table/">Table</a> or another stream to provide more comprehensive details about their respective <a href="../../event/event/">Events</a>.</p>
<h2 id="problem">Problem</h2>
<p>How can I enrich an event stream or table with additional context?</p>
<h2 id="solution">Solution</h2>
<p><img alt="event joiner" src="../../img/event-joiner.png" /></p>
<p>You can combine events in a stream with another stream or table by performing a join between the two.  The join is based on a key the stream and the "other" stream or table have in common.  Also you can provide a window buffering mechanism based on timestamps so you can produce join results when events from both streams aren't immediately available.  Another approach is to join a stream and a table where the table contains more static data resulting in an enriched event stream. </p>
<h2 id="implementation">Implementation</h2>
<p>With ksqlDB we can create a stream of events from an existing Kafka topic (note this example's similarity to <a href="https://en.wikipedia.org/wiki/Fact_table">fact tables</a> in data warehouses):</p>
<pre><code class="language-sql">CREATE STREAM ratings (MOVIE_ID INT KEY, rating DOUBLE)
    WITH (KAFKA_TOPIC='ratings');
</code></pre>
<p>Then create a table from on another existing Kafka topic that changes less frequently. This table serves as our reference data (cf. <a href="https://en.wikipedia.org/wiki/Dimension_(data_warehouse)">dimension tables</a> in data warehouses).</p>
<pre><code class="language-sql">CREATE TABLE movies (ID INT PRIMARY KEY, title VARCHAR, release_year INT)
    WITH (KAFKA_TOPIC='movies');

</code></pre>
<p>To create a stream of enriched events, we perform a join between the stream and the table.</p>
<pre><code class="language-sql">SELECT ratings.movie_id AS ID, title, release_year, rating
   FROM ratings
   LEFT JOIN movies ON ratings.movie_id = movies.id
   EMIT CHANGES;
</code></pre>
<h2 id="considerations">Considerations</h2>
<ul>
<li>
<p>In ksqlDB, joins between a stream and a table are driven by the stream side of the join.  Updates to the table only update the state of the table.  It's the new event in the stream that results in a new join result.  For example, if you're joining a stream of orders to a table of customers a new order will be enriched if there is a customer record in the table. But if a new customer is added to the table it will not trigger the join condition. The <a href="https://docs.ksqldb.io/en/latest/developer-guide/joins/join-streams-and-tables/#semantics-of-stream-table-joins">ksqlDB documentation contains more information on stream-table join semantics</a>. </p>
</li>
<li>
<p>You can perform an inner or left-outer join between a stream and a table.</p>
</li>
<li>
<p>Joins are also useful to initiate subsequent processing when two (or more) corresponding events arrive on different streams or tables.</p>
</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://kafka-tutorials.confluent.io/join-a-stream-to-a-table/ksql.html">Tutorial: How to join a stream and a lookup table in ksqlDB</a></li>
<li><a href="https://kafka-tutorials.confluent.io/join-a-stream-to-a-stream/ksql.html">Tutorial: Joining a stream and a stream in ksqlDB</a></li>
<li><a href="https://kafka-tutorials.confluent.io/join-a-table-to-a-table/ksql.html">Tutorial: How to join a table and a table in ksqlDB</a></li>
<li><a href="https://kafka-tutorials.confluent.io/multi-joins/ksql.html">Tutorial: Performing N-way joins in ksqlDB</a></li>
<li><a href="https://docs.ksqldb.io/en/latest/developer-guide/joins/join-streams-and-tables/">Joining Collections in the ksqlDB documentation</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../event-stream-merger/" class="btn btn-neutral float-right" title="Event Stream Merger">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../event-grouper/" class="btn btn-neutral" title="Event Grouper"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../event-grouper/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../event-stream-merger/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
