<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Event Router - Event Streaming Patterns</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Event Router";
    var mkdocs_page_input_path = "event-processing/event-router.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Event Streaming Patterns</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Event Streaming Patterns</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Compositional patterns</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../compositional-patterns/command-query-responsibility-segregation/">Command Query Responsibility Segregation (CQRS)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../compositional-patterns/event-collaboration/">Event Collaboration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../compositional-patterns/geo-replication/">Geo Replication</a>
                </li>
                <li class="">
                    
    <a class="" href="../../compositional-patterns/pipeline/">Pipeline</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event/correlation-identifier/">Correlation Identifier</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event-deserializer/">Event Deserializer</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event-envelope/">Event Envelope</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event-serializer/">Event Serializer</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event-standardizer/">Event Standardizer</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/event/">Event</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event/schema-on-read/">Schema-On-Read</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event processing</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../claim-check/">Claim Check</a>
                </li>
                <li class="">
                    
    <a class="" href="../dead-letter-stream/">Dead Letter Stream</a>
                </li>
                <li class="">
                    
    <a class="" href="../event-chunking/">Event Chunking</a>
                </li>
                <li class="">
                    
    <a class="" href="../event-filter/">Event Filter</a>
                </li>
                <li class="">
                    
    <a class="" href="../event-mapper/">Event Mapper</a>
                </li>
                <li class="">
                    
    <a class="" href="../event-processing-application/">Event Processing Application</a>
                </li>
                <li class="">
                    
    <a class="" href="../event-processor/">Event Processor</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Event Router</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#event-router">Event Router</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#problem">Problem</a></li>
        
            <li><a class="toctree-l4" href="#solution">Solution</a></li>
        
            <li><a class="toctree-l4" href="#implementation">Implementation</a></li>
        
            <li><a class="toctree-l4" href="#considerations">Considerations</a></li>
        
            <li><a class="toctree-l4" href="#references">References</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../event-splitter/">Event Splitter</a>
                </li>
                <li class="">
                    
    <a class="" href="../event-streaming-api/">Event Streaming API</a>
                </li>
                <li class="">
                    
    <a class="" href="../event-translator/">Event Translator</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event sink</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event-sink/event-sink-connector/">Event Sink Connector</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-sink/event-sink/">Event Sink</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event source</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event-source/database-write-aside/">Database Write Aside</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/database-write-through/">Database Write Through</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/event-gateway/">Event Gateway</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/event-source-connector/">Event Source Connector</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/event-source/">Event Source</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-source/schema-validator/">Schema Validator</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event storage</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event-storage/compacted-event-stream/">Compacted Event Stream</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-storage/event-store/">Event Store</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-storage/infinite-retention-event-stream/">Infinite Retention Event Stream</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Event stream</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../event-stream/event-broker/">Event Broker</a>
                </li>
                <li class="">
                    
    <a class="" href="../../event-stream/event-stream/">Event Stream</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Stream processing</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../stream-processing/event-grouper/">Event Grouper</a>
                </li>
                <li class="">
                    
    <a class="" href="../../stream-processing/event-joiner/">Event Joiner</a>
                </li>
                <li class="">
                    
    <a class="" href="../../stream-processing/event-stream-merger/">Event Stream Merger</a>
                </li>
                <li class="">
                    
    <a class="" href="../../stream-processing/event-time-processing/">Event-Time Processing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../stream-processing/logical-and/">Logical AND</a>
                </li>
                <li class="">
                    
    <a class="" href="../../stream-processing/suppressed-event-aggregator/">Suppressed Event Aggregator</a>
                </li>
                <li class="">
                    
    <a class="" href="../../stream-processing/wait-for-n-events/">Wait for N Events</a>
                </li>
                <li class="">
                    
    <a class="" href="../../stream-processing/wallclock-time/">Wallclock-Time Processing</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Table</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../table/projection-table/">Projection Table</a>
                </li>
                <li class="">
                    
    <a class="" href="../../table/state-table/">State Table</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Event Streaming Patterns</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Event processing &raquo;</li>
        
      
    
    <li>Event Router</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="event-router">Event Router</h1>
<p><a href="../../event-stream/event-stream/">Event Streams</a> may contain a subset of <a href="../../event/event/">Events</a> which need to be processed in isolation. For example, an inventory check system may be distributed across multiple physical systems, and the target system depends on the category of the item being checked. </p>
<h2 id="problem">Problem</h2>
<p>How can we isolate <a href="../../event/event/">Events</a> into a dedicated <a href="../../event-stream/event-stream/">Event Stream</a> based on some attribute of the <a href="../../event/event/">Events</a>?</p>
<h2 id="solution">Solution</h2>
<p><img alt="event-router" src="../../img/event-router.png" /></p>
<h2 id="implementation">Implementation</h2>
<p>With <a href="https://ksqldb.io/">ksqlDB</a>, you can continuously route events to a different stream using the <code>CREATE STREAM</code> syntax with an appropriate <code>WHERE</code> filter.</p>
<pre><code>CREATE STREAM payments ...;

CREATE STREAM payments_france AS
    SELECT * FROM payments WHERE country = 'france';

CREATE STREAM payments_spain AS
    SELECT * FROM payments WHERE country = 'spain';
</code></pre>
<p>With the <a href="https://kafka.apache.org/documentation/streams/">Kafka Streams library</a>, use a <a href="https://kafka.apache.org/28/javadoc/org/apache/kafka/streams/processor/TopicNameExtractor.html">TopicNameExtractor</a> to route events to different streams (topics).  The <code>TopicNameExtractor</code> has one method to implement, <code>extract()</code>, which accepts three parameters:</p>
<ul>
<li>The event key</li>
<li>The event value</li>
<li>The <a href="https://kafka.apache.org/28/javadoc/org/apache/kafka/streams/processor/RecordContext.html">RecordContext</a>, which provides access to headers, partitions, and other contextual information about the event.</li>
</ul>
<p>You can use any of the given parameters to generate and return the desired destination topic name for the given event, and Kafka Streams will complete the routing. </p>
<pre><code class="language-java">CountryTopicExtractor implements TopicNameExtractor&lt;String, String&gt; {
   String extract(String key, String value, RecordContext recordContext) {
      switch (value.country) {
        case &quot;france&quot;:
          return &quot;france-topic&quot;;
        case &quot;spain&quot;:
          return &quot;spain-topic&quot;;
      }
   }
}

KStream&lt;String, String&gt; myStream = builder.stream(...);
myStream.mapValues(..).to(new CountryTopicExtractor());
</code></pre>
<h2 id="considerations">Considerations</h2>
<ul>
<li>Event Routers should not modify the Event itself and instead only provide the proper routing to the desired destinations.</li>
<li>Consider the use of an <a href="../../event/event-envelope/">Event Envelope</a> if an event router should attach additional information or context to an event.</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>This pattern is derived from <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/MessageRouter.html">Message Router</a> in Enterprise Integration Patterns by Gregor Hohpe and Bobby Woolf</li>
<li>See the tutorial <a href="https://kafka-tutorials.confluent.io/dynamic-output-topic/kstreams.html">How to dynamically choose the output topic at runtime</a> for a full example of dynamically routing events at runtime.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../event-splitter/" class="btn btn-neutral float-right" title="Event Splitter">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../event-processor/" class="btn btn-neutral" title="Event Processor"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../event-processor/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../event-splitter/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
